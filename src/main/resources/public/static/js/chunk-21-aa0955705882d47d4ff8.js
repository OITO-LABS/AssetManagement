(window.webpackJsonp=window.webpackJsonp||[]).push([[21],{jfEs:function(e,t,a){"use strict";a.r(t);var l=a("q1tI"),s=a.n(l),i=a("Bbg3"),n=a("ICSB"),r=a("8vYt"),m=a("qcPu");a("AjUr");t.default=class extends l.Component{constructor(e){super(e),this.validateFieldData=this.validateFieldData.bind(this),this.validator=new r.default([{field:"reimbursementDate",method:"isEmpty",args:[{ignore_whitespace:!0}],validWhen:!1,message:"Reimbursement date is empty"},{field:"billDate",method:"isEmpty",args:[{ignore_whitespace:!0}],validWhen:!1,message:"Reimbursement date is empty"},{field:"reimbursementDescription",method:"isEmpty",args:[{ignore_whitespace:!0}],validWhen:!1,message:"Reimbursement description is empty"},{field:"categoryName",method:"isEmpty",args:[{ignore_whitespace:!0}],validWhen:!1,message:"Category name description is empty"},{field:"billNo",method:"isEmpty",args:[{ignore_whitespace:!0}],validWhen:!1,message:"Bill number is empty"},{field:"cost",method:"isEmpty",args:[{ignore_whitespace:!0}],validWhen:!1,message:"Cost is empty"}]),this.state={reimbursementDetails:[{index:1,billDate:"",reimbursementDescription:"",categoryName:"",billNo:"",cost:0,flag:!1}],category:[],validation:this.validator.valid()},this.handleInputChange=this.handleInputChange.bind(this),this.getCategoryOptions=this.getCategoryOptions.bind(this),this.fieldData={},this.handleInputChange2=this.handleInputChange2.bind(this),this.onSubmit=this.onSubmit.bind(this),this.subTotal=this.subTotal.bind(this),this.handleAdd=this.handleAdd.bind(this),this.handleDelete=this.handleDelete.bind(this)}componentDidMount(){app.events.trigger(i.o,{status:!1,reset:!0}),m.a.getRequest("getReimCategory").then(e=>{this.setState({category:e})}).catch(e=>{console.log(e)})}getCategoryOptions(){let e=[];return e=this.state.category.map(e=>({value:e.categoryName,label:e.categoryName}))}handleInputChange2(e,t){let a=t.field||e.target.name,l=t.value||e.target.value||"",s=t.index;console.log(s);let i=this.state.reimbursementDetails.find(e=>e.index==s);console.log(i),i[a]=l,this.setState(i),this.subTotal()}handleAdd(){let e=[...this.state.reimbursementDetails];e.push({index:Math.random(),billDate:"",reimbursementDescription:"",categoryName:"",billNo:"",cost:0,flag:!1}),this.setState({reimbursementDetails:e})}handleInputChange(e,t={}){let a=t.field||e.target.name,l=t.value||e.target.value||"";this.fieldData[a]=t,e&&this.setState({[a]:"checkbox"==e.target.type?e.target.checked:l})}subTotal(){let e=0;this.state.reimbursementDetails.forEach(t=>{""!=t.cost&&(e+=parseInt(t.cost))}),this.setState({totalCost:e})}onSubmit(){const e=this.validator.validate(this.state);this.setState({validation:e}),this.submitted=!0;var t=this.state.reimbursementDate,a=this.state.totalCost,l=this.state.reimbursementDetails;e.isValid&&m.a.formDataRequest("reimbursementApply",{empNo:app.userDetails.empNo,reimbursementDate:t,totalCost:a,reimbursementDetails:l}).then(e=>{"success"==e.status?(app.events.trigger(i.I,{visible:!0,type:i.b.SUCESS,msg:"Successfully Submitted"}),setTimeout(()=>{app.events.trigger(i.q,{routerKey:REIMBURSEMENT_LISTING})},3e3)):app.events.trigger(i.I,{visible:!0,type:i.b.DANGER,msg:`${e.message}`})}).catch(e=>{console.log(e)})}getStateData(e){return{billDate:e.billDate||"",billDate:e.billDate||"",reimbursementDescription:e.reimbursementDescription||"",categoryName:e.categoryName||"",billNo:e.billNo||"",cost:e.cost||""}}validateFieldData(e,t,a,l,s){return this.fieldData[s]&&!!this.fieldData[s][t.propName]}handleInputChange1(e){console.log(e)}handleDelete(e){let t=this.state.reimbursementDetails.filter(t=>t.index!=e.index);t.length>=1&&this.setState({reimbursementDetails:t},()=>{this.subTotal()})}render(){let e=this.submitted?this.validator.validate(this.state):this.state.validation;return s.a.createElement(s.a.Fragment,null,s.a.createElement("div",{className:"container-fluid"},s.a.createElement("div",{className:"container mt-3"},s.a.createElement("div",{className:"row mt-5"},s.a.createElement("div",{className:"d-flex mb-4 flex-row mx-auto"},s.a.createElement("div",null,s.a.createElement(n.default,{label:"Reimbursement Date",labelClassName:"txt-label",fieldClassName:"txt-input",mandatory:!0,onChange:this.handleInputChange,name:"reimbursementDate",type:"date",value:this.state.reimbursementDate,placeholder:"reimbursementDate",validator:e})),s.a.createElement("div",null,s.a.createElement(n.default,{label:"Upload Profile Pic",labelClassName:"txt-label",fieldClassName:"txt-input",type:"file",onChange:this.handleInputChange,name:"file",value:this.state.file,validator:e})))),s.a.createElement("div",{className:"row personal-assets mt-5"},s.a.createElement("table",{className:"table single-asset input-style"},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",null,"Bill Date"),s.a.createElement("th",null,"Description"),s.a.createElement("th",null,"Category"),s.a.createElement("th",null,"Bill Number"),s.a.createElement("th",null,"Cost"))),s.a.createElement("tbody",null,this.state.reimbursementDetails.map((t,a)=>s.a.createElement("tr",{key:a},s.a.createElement("td",null,s.a.createElement(n.default,{labelClassName:"txt-label",fieldClassName:"txt-input",mandatory:!0,onChange:()=>this.handleInputChange2(event,t),name:"billDate",type:"date",value:t.billDate,placeholder:"Bill Date",validator:e})),s.a.createElement("td",null,s.a.createElement(n.default,{labelClassName:"txt-label",fieldClassName:"txt-input",mandatory:!0,onChange:()=>this.handleInputChange2(event,t),name:"reimbursementDescription",value:t.reimbursementDescription,placeholder:"Reimbursement Description",validator:e})),s.a.createElement("td",null,s.a.createElement(n.default,{type:"select",searchable:!0,labelClassName:"txt-label",fieldClassName:"select-input",mandatory:!0,name:"categoryName",nameAlias:"categoryName",extraProps:t,onChange:this.handleInputChange2,options:this.getCategoryOptions(),value:t.categoryName,placeholder:"Category Name",validator:e})),s.a.createElement("td",null,s.a.createElement(n.default,{labelClassName:"txt-label",fieldClassName:"txt-input",mandatory:!0,onChange:()=>this.handleInputChange2(event,t),name:"billNo",value:t.billNo,placeholder:"Bill Number",validator:e})),s.a.createElement("td",null,s.a.createElement(n.default,{labelClassName:"txt-label",fieldClassName:"txt-input",mandatory:!0,onChange:()=>this.handleInputChange2(event,t),name:"cost",value:t.cost,placeholder:"Cost",type:"number",validator:e})),s.a.createElement("td",null,s.a.createElement("button",{className:"btn btn-success",onClick:this.handleAdd},s.a.createElement("i",{className:"fas fa-plus"}))),s.a.createElement("td",null,s.a.createElement("button",{className:"btn btn-danger",onClick:()=>{this.handleDelete(t)}},s.a.createElement("i",{className:"fas fa-minus"}))))),s.a.createElement("tr",null,s.a.createElement("td",null),s.a.createElement("td",null),s.a.createElement("td",null),s.a.createElement("td",null,s.a.createElement("label",{className:"txt-label d-flex justify-content-center"},"Total")),s.a.createElement("td",null,s.a.createElement("label",{className:"txt-label d-flex"},"Rs.",this.state.totalCost))))),s.a.createElement("div",{className:"mx-auto"},s.a.createElement("button",{className:"submit-btn",onClick:this.onSubmit},"Submit"))))))}}}}]);